# ⚠️ 多选题识别问题报告

---

**最简单的解决办法：** 把单选与多选分成两个文件分别导入

---

## 问题描述

用户的 `Ti/t1.txt` 文件包含：
- **单选题：** 16 道
- **多选题：** 6 道
- **总计：** 22 道

但 AI 只识别并上传了 **16 道单选题**，**完全遗漏了 6 道多选题**。

## 根本原因分析

### AI 模型处理结果
qwen2.5 返回的 JSON 格式为：
```json
{
  "questions": [
    { "text": "单选题1", "type": "SINGLE_CHOICE", ... },
    { "text": "单选题2", "type": "SINGLE_CHOICE", ... },
    ...
    { "text": "单选题16", "type": "SINGLE_CHOICE", ... }
  ]
}
```

**问题：** `questions` 数组只包含单选题，完全没有识别多选题部分。

### 可能的原因
1. **Prompt 问题** - System Prompt 中可能对多选题部分的处理不够明确
2. **模型局限性** - AI 在处理含有多个部分的文档时可能存在漏洞
3. **格式识别** - "二、多项选择题" 的格式识别可能不完整

## 解决方案

### 方案 1：拆分文档（推荐）
将 `Ti/t1.txt` 分成两个文件：

**文件 1：`Ti/t1_single.txt`（单选题）**
```
一、单项选择题
1. "马克思主义中国化"的命题...
...
16. 中国革命、建设和改革的实践证明...
```

**文件 2：`Ti/t1_multiple.txt`（多选题）**
```
二、多项选择题
1. 实践证明，中国共产党为什么能...
...
6. 马克思主义中国化时代化的基本要求...

答案：
1.CD 2.BCD 3.AB 4.AB 5.AB 6.ABCD
```

然后分别运行：
```bash
npm start ./Ti/t1_single.txt "毛概"
npm start ./Ti/t1_multiple.txt "毛概"
```

### 方案 2：改进 System Prompt
如果想在一个文件中处理，需要更明确的 Prompt 指导。当前 Prompt 可能需要加强对多选题的说明。

### 方案 3：手动处理
在 Supabase 中手动添加 6 道多选题。

## 代码改进（已完成）

### 1. 增强数据结构识别
代码现在支持以下格式：
- ✅ `{ questions: [...] }`
- ✅ `{ items: [...] }`
- ✅ `{ data: [...] }`
- ✅ `{ text: [...] }` **(新增)**
- ✅ `{ single_choice: [...], multiple_choice: [...] }` 合并 **(新增)**

### 2. 合并逻辑
当 AI 返回单选和多选的混合格式时，代码会自动合并：
```typescript
if (hasSingleChoice && hasMultipleChoice) {
  const combined = [...data.single_choice, ...data.multiple_choice];
  logger.info(`合并单选 ${singleCount} 题和多选 ${multipleCount} 题，共 ${combined.length} 题`);
}
```

## 建议操作

### 立即操作
1. **使用方案 1**（拆分文档）是最可靠的方案
2. 创建 `Ti/t1_single.txt` 和 `Ti/t1_multiple.txt`
3. 分别处理两个文件

### 后续优化
1. 测试改进的 AI Prompt
2. 如果 Prompt 改进有效，就可以一次性处理
3. 或升级到更强大的 AI 模型

## 总结

| 方面 | 状态 | 说明 |
|------|------|------|
| 单选题识别 | ✅ 100% | 16/16 题目正确 |
| 多选题识别 | ❌ 0% | AI 未返回多选题数据 |
| 代码兼容性 | ✅ 强化 | 支持多种返回格式 |
| 推荐方案 | 拆分文档 | 最可靠且快速 |

---

**关键：** 这是 AI 模型本身的限制，而不是代码问题。建议使用拆分文档方案获得最佳效果。
